# Batting Order Optimizer

NPB野手の実際の成績をもとに、得点効率のよい打順を探索するアプリケーションです。

## 概要

このアプリケーションは、NPB（日本プロ野球）の野手成績データに基づき、最も得点効率の良い打順を探索することを目的としています。StreamlitのインタラクティブなUIを通じて、実際のデータに基づいた打順シミュレーションを体験できます。

## 主要機能

### 1. 年度・チーム選択機能
サイドバーからシミュレーション対象とする年度とチームを選択できます。選択されたデータに基づいて選手一覧が表示されます。

### 2. 任意の打順シミュレーション機能
選択されたチームの選手を自由に打順に配置し、1試合（9イニング）のシミュレーションを実行します。シミュレーション結果として、総得点、イニングごとの詳細なプレイログ、打者ごとの成績（打席数、安打数、打点、打率など）が表示されます。

### 3. 最良打順推定機能
ユーザーが指定した回数（例: 1000回）のランダムな打順を生成し、それぞれの打順で143試合（NPBレギュラーシーズン相当）のシミュレーションを自動で実行します。その結果に基づいて、最も平均得点が高かった打順と低かった打順、およびそれぞれの詳細な成績が表示されます。

## 使い方

1.  **アプリケーションの起動**
    ```bash
    streamlit run main.py
    ```
2.  **年度とチームの選択**
    サイドバーの「📊 シミュレーション設定」から、シミュレーションを行いたい年度とチームを選択します。
3.  **任意の打順でシミュレーション**
    「📝 任意の打順でシミュレーション」セクションで、1番から9番までの打者を選択します。同じ選手を複数回選択することも可能です。打順を設定したら、「⚾ 1試合シミュレーション実行」ボタンをクリックすると、シミュレーション結果が表示されます。
4.  **最良打順の推定**
    サイドバーの「🔍 最良打順推定設定」から、試行回数を指定します。試行回数を増やすほど推定の精度は向上しますが、シミュレーションに時間がかかります。試行回数を設定したら、「最良打順を推定して表示」ボタンをクリックします。任意の打順で選択した9人の選手の中から、最も得点効率の良い打順と悪い打順が推定され、結果が表示されます。

## ファイル構造

```
BattingOrderOptimizer/
├── .gitignore
├── .python-version
├── Design.md
├── Gemini.md
├── main.py                 # Streamlitアプリケーションのメインファイル
├── pyproject.toml
├── README.md               # このファイル
├── task.md
├── uv.lock
├── app/
│   ├── __init__.py
│   ├── services/
│   │   ├── __init__.py
│   │   └── simulation.py   # シミュレーションのコアロジックを実装
│   └── utils/
│       ├── __init__.py
│       ├── add_speed_score.py # 選手データに走力スコアを追加するロジック
│       └── get_player_data.py # 選手データの取得と加工ロジック
├── data/
│   ├── processed/          # 処理済みの選手データCSVファイル
│   │   └── (年度)_(チーム略称).csv
│   └── raw/                # 生の選手データCSVファイル
│       └── (年度)_(チーム略称).csv
└── tests/
    ├── __init__.py
    └── test_simulation.py    # シミュレーションロジックのテストコード
```

## 動作環境

*   **言語/フレームワーク**: Python 3.12以降
*   **主要ライブラリ**: Streamlit, Pandas, NumPy