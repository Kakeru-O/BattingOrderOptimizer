# タスクリスト

## 1. 開発環境構築 (済)
- [x] Python環境設定 (`.python-version`, `uv.lock`)
- [x] Gitリポジトリ初期化 (`.git`)
- [x] 基本的なファイル作成 (`main.py`, `README.md`, `Design.md`, `Gemini.md`)

## 2. データ準備 (済)
- [x] 選手データの収集と配置 (`data/raw`, `data/processed`)
- [x] データ取得モジュールの実装 (`app/utils/get_player_data.py`)

## 3. Streamlitアプリケーション基盤構築
- [x] `main.py`にStreamlitの基本的なコードを追加
- [x] アプリケーションのタイトルと概要説明を表示 (`st.title`, `st.write`)

## 4. 年度・チーム選択機能の実装
- [x] `st.sidebar`を作成
- [x] 年度を選択する`st.selectbox`をサイドバーに配置
- [x] チームを選択する`st.selectbox`をサイドバーに配置
- [x] 選択された年度とチームに応じて、対応するCSVファイルを読み込む処理を実装
- [x] 読み込んだデータをPandas DataFrameとしてキャッシュする (`st.cache_data`)

## 5. シミュレーションコアロジックの実装
- [x] 1打席の結果をシミュレートする関数を作成 (選手の成績データと乱数を使用)
- [x] 1イニングのシミュレーションを行う関数を作成
- [x] 1試合（9イニング）のシミュレーションを行う関数を作成
- [x] シミュレーション結果（得点、安打、打者別成績など）を返すデータ構造を定義

## 6. 任意の打順シミュレーション機能の実装
- [x] 読み込んだ選手データ一覧をメイン画面に表示 (`st.dataframe`)
- [x] 1番から9番までの打順を`st.selectbox`で選択できるUIを作成
- [x] 「シミュレーション実行」ボタン (`st.button`) を配置
- [x] ボタンが押されたら、シミュレーションコアロジックを実行
- [x] 試合結果（総得点など）を`st.metric`で表示
- [x] イニングごとの詳細ログを`st.expander`内に表示
- [x] 打者ごとの成績を`st.dataframe`で表示

## 7. 最良打順推定機能の実装
- [x] 試行回数を指定する`st.number_input`をサイドバーに配置
- [x] 「最良打順を推定」ボタン (`st.button`) を配置
- [x] 指定回数分、ランダムな打順（選手重複なし）を生成
- [x] 各打順で143試合のシミュレーションを実行
- [x] 実行中に`st.progress`と`st.spinner`で進捗を表示
- [x] 最も平均得点が高かった打順と、その成績を表示
- [x] 最も平均得点が低かった打順と、その成績を表示
- [x] (オプション) 得点分布を`st.bar_chart`で可視化

## 8. 全体調整と仕上げ
- [x] UI/UXの改善（レイアウト、文言など）
- [x] エラーハンドリングの強化（無効な入力など）
- [x] コードのリファクタリングとコメント追加
- [x] `README.md`の更新（使い方、機能一覧、ファイル構造図など）

---

## 今後の改善タスク案

### A. シミュレーション精度の向上
- [ ] **高度な進塁ロジックの実装:**
    - [ ] 打球種（ゴロ、フライ、ライナー）の概念を導入
    - [x] 走者の走力、打球の状況に応じた進塁判断（例: 1塁打で1塁走者が3塁へ進塁するケース）
    - [ ] 盗塁、タッチアップ、進塁打などの細かいプレーを実装
- [ ] **投手データの考慮:**
    - [ ] 左右の相性（右投手 vs 左打者など）をシミュレーションに反映
    - [ ] 投手の能力（防御率、奪三振率など）を失点率に反映
- [ ] **特殊なプレーの実装:**
    - [ ] 併殺打（ダブルプレー）のロジックをより精緻化
    - [ ] エラー（失策）の発生を確率的に実装

### B. パフォーマンスと技術的改善
- [x] **シミュレーションの高速化:**
    - [x] 不要なイニングログ生成のスキップによる最適化
    - [ ] NumPyを活用した計算処理の最適化
    - [ ] マルチプロセス/マルチスレッドによる並列処理化
- [x] **テストの導入:**
    - [x] `pytest`による単体テスト・結合テストのフレームワークを導入
    - [x] シミュレーションのコアロジックに対するテストケースを作成
- [ ] **CI/CDの構築:**
    - [ ] GitHub Actionsなどで、プッシュ時に自動でテストを実行するワークフローを構築

### C. UI/UXと可視化の強化
- [ ] **インタラクティブな結果表示:**
    - [ ] PlotlyやAltairを導入し、より表現力豊かなグラフを作成
        - [ ] 得点分布のヒストグラム
        - [ ] 打順別平均得点の箱ひげ図
        - [ ] 選手の成績を可視化するレーダーチャート
    - [ ] シミュレーション結果のデータフレームにソート・フィルタリング機能を追加
- [ ] **デザインの改善:**
    - [ ] Streamlitのテーマ機能やカスタムCSSで、野球らしいデザインを適用
- [ ] **ユーザー体験の向上:**
    - [ ] シミュレーション中の詳細な進捗表示（例: 「〇〇通りの打順を検証中...」）

### D. 機能拡張
- [ ] **分析機能の追加:**
    - [ ] 総得点と各打撃指標（出塁率、長打率など）との相関係数を計算・表示
    - [ ] 特定の選手を固定した状態での最適打順探索機能
- [ ] **データ管理機能:**
    - [ ] ユーザーが独自の選手データをアップロード・編集できる機能
- [ ] **ドキュメント:**
    - [ ] アプリの仕様やシミュレーションの前提条件をまとめたドキュメントページをアプリ内に作成 (`st.expander`や別ページ)
- [ ] **デフォルトでスタメンデータを持っておく:**
    - [ ] 守備位置別に最多出場選手をピックアップ
- [ ] **DHモード:**
    - [ ] DHなしの場合、投手を仮定した仮の選手を一人投入する
### E. その他
- [ ] **エラーハンドリングの強化:**
    - [ ] データファイルが存在しない場合や、フォーマットが不正な場合のハンドリングを改善
